<!DOCTYPE html>
<html>
<head>
<title>商品属性类型列表</title>
<meta http-equiv="pragma" content="no-cache">
<meta http-equiv="cache-control" content="no-cache">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="keywords" content="Online Charge System,亿网星漫">
<meta http-equiv="description" content="Online Charge System">
<link rel="stylesheet" type="text/css"
	href="../easyUI/themes/default/easyui.css">
<link rel="stylesheet" type="text/css" href="../easyUI/themes/icon.css">
<link rel="stylesheet" type="text/css" href="../css/style.css">
<script type="text/javascript" src="../easyUI/jquery-1.8.0.min.js"></script>
<script type="text/javascript" src="../js/safe.js"></script>
<script type="text/javascript" src="../easyUI/jquery.easyui.min.js"></script>
<script type="text/javascript"
	src="../easyUI/locale/easyui-lang-zh_CN.js"></script>
<script type="text/javascript">
		$(function(){
			$('#tt').datagrid({
				title:'商品属性列表',
				iconCls:'icon-search',
				singleSelect:true,
				idField:'typeId',
				pagination:true,
				fitColumns:true,
				url:'../ajax/goodsProp_query',
				columns:[[
					{field:'typeId',title:'ID',width:10},
					{field:'typeName',title:'类型名称',width:40,editor:'text'},
					{field:'note',title:'备注',width:100,editor:'text'},
					{field:'valid',title:'是否有效',align:'center',
					    formatter:function(value,row,index){
					        //debugger;
					        value = value + '';
							if (value == 'true'){
								return '有效';
							} else if(value == 'false') {
								return '无效';
							}else{
							    return value;
							}
						},
						editor:{
							type:'checkbox',
							options:{
								on: 'true',
								off: 'false'
							}
						}
					},
					{field:'action',title:'操作',width:20,align:'center',
						formatter:function(value,row,index){
							if (row.editing){
							var s = '<a href="#" onclick="saverow(this)">保存</a> ';
							var c = '<a href="#" onclick="cancelrow(this)">取消</a>';
							return s+c;
							} else {
								var e = '<a href="#" onclick="editrow(this)">修改</a> ';
								return e;
							}
						}
					}
				]],
				onBeforeEdit:function(index,row){
					row.editing = true;
					row.valid = row.valid + '';
					updateActions(index);
				},
				onAfterEdit:function(index,row){
					row.editing = false;
					$.ajax({
					    type    :'POST',
					    url     :'../ajax/goodsProp_edit',
					    data    :row,
					    success :function(result){
					    	$.messager.show({
								title:'提示',
								msg:result,
								timeout:2000,
								showType:'slide'
							});
					    },
					    error   :function(error){
					        alert('error');
					    }, 
					    dataType:'html'
						});
					updateActions(index);
				},
				onCancelEdit:function(index,row){
					row.editing = false;
					updateActions(index);
				}
			});
		});
		function query(){
			var arr = $('#thisform').serializeArray();
			var param = {};
			$.each(arr, function(index) {
			    if(this['value'] != ''){
					if (param[this['name']]) {
						param[this['name']] = param[this['name']] + "," + this['value'];
					} else {
						param[this['name']] = this['value'];
					}
				}
			});
			$('#tt').datagrid('load',param);
		}
		
		function updateActions(index){
			$('#tt').datagrid('updateRow',{
				index: index,
				row:{}
			});
		}
		function getRowIndex(target){
			var tr = $(target).closest('tr.datagrid-row');
			return parseInt(tr.attr('datagrid-row-index'));
		}
		function editrow(target){
			$('#tt').datagrid('beginEdit', getRowIndex(target));
		}
		function saverow(target){
			$('#tt').datagrid('endEdit', getRowIndex(target));
		}
		function cancelrow(target){
			$('#tt').datagrid('cancelEdit', getRowIndex(target));
		}
	</script>
</head>
<body>
	<form id="thisform">
		<fieldset style="width: 400px;">
			<legend>查询条件</legend>
			<div class="field">
				<label for="typeName">类型名称</label> <input id="typeName" type="text"
					name="typeName" tabindex="1">
			</div>
			<div class="field">
				<label for="valid">是否有效</label> <select id="valid" name="valid">
					<option value="">全部</option>
					<option value="true" selected="selected">有效</option>
					<option value="false">无效</option>
				</select>
			</div>
			<div class="button">
				<button type="button" onclick="query();">查询</button>
			</div>
		</fieldset>
	</form>
	<table id="tt"></table>
</body>
</html>